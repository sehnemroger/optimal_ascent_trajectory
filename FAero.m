function [FA,FN,Cx,gradCx,HessCx,CNx,gradCNx,HessCNx,rhoe]=FAero(Mach,alfa,X,VR,ie,Foguete)
%Calculo das forças aerodinâmicas de acordo com Paulo Sergio Pg. 140
% Entradas:  Mach
%                   alpha [rad] (angulo de ataque) 
%                   h [m] (altitude)
%                   VR [m/s] (velocidade relativa do ar)
%                   ie (estagio atual)
%                   Foguete (objeto com as informações do foguete)

WE=7.292115856e-5; % modulo da velociodade angular da terra
RE=6378145;
i=Foguete.i;
cosi=cos(i);

r=X(1); sigma=X(2); u=X(3); v=X(4); m=X(5);

h=r-RE;
S=Foguete.Sref;
rhoe=rho(h);
q=.5*rhoe*VR^2;

%% Derivadas do som


[vsomr,vsomrr]=Vsom_devs(r);
vsom=Vsom(h);
%% Parciais de Mach
gradMach=[vsom.^(-2).*(u.^2+(v+(-1).*cosi.*r.*WE).^2).^(-1/2).*(cosi.* ...
                      vsom.*WE.*((-1).*v+cosi.*r.*WE)+(-1).*vsomr.*(u.^2+(v+(-1).*cosi.* ...
                      r.*WE).^2)),u.*vsom.^(-1).*(u.^2+(v+(-1).*cosi.*r.*WE).^2).^(-1/2) ...
                      ,vsom.^(-1).*(v+(-1).*cosi.*r.*WE).*(u.^2+(v+(-1).*cosi.*r.*WE) ...
                      .^2).^(-1/2)];
HessMach=[vsom.^(-3).*(u.^2+(v+(-1).*cosi.*r.*WE).^2).^(-3/2).*(cosi.^2.* ...
                          u.^2.*vsom.^2.*WE.^2+2.*vsomr.^2.*(u.^2+(v+(-1).*cosi.*r.*WE).^2) ...
                          .^2+vsom.*(u.^2+(v+(-1).*cosi.*r.*WE).^2).*(2.*cosi.*vsomr.*WE.*( ...
                          v+(-1).*cosi.*r.*WE)+(-1).*vsomrr.*(u.^2+(v+(-1).*cosi.*r.*WE).^2) ...
                          )),(-1).*u.*vsom.^(-2).*(u.^2+(v+(-1).*cosi.*r.*WE).^2).^(-3/2).*( ...
                          cosi.*vsom.*WE.*((-1).*v+cosi.*r.*WE)+vsomr.*(u.^2+(v+(-1).*cosi.* ...
                          r.*WE).^2)),vsom.^(-2).*(u.^2+(v+(-1).*cosi.*r.*WE).^2).^(-3/2).*( ...
                          (-1).*cosi.*u.^2.*vsom.*WE+(-1).*vsomr.*(v+(-1).*cosi.*r.*WE).*( ...
                          u.^2+(v+(-1).*cosi.*r.*WE).^2));(-1).*u.*vsom.^(-2).*(u.^2+(v+(-1) ...
                          .*cosi.*r.*WE).^2).^(-3/2).*(cosi.*vsom.*WE.*((-1).*v+cosi.*r.*WE) ...
                          +vsomr.*(u.^2+(v+(-1).*cosi.*r.*WE).^2)),vsom.^(-1).*(v+(-1).* ...
                          cosi.*r.*WE).^2.*(u.^2+(v+(-1).*cosi.*r.*WE).^2).^(-3/2),u.* ...
                          vsom.^(-1).*((-1).*v+cosi.*r.*WE).*(u.^2+(v+(-1).*cosi.*r.*WE).^2) ...
                          .^(-3/2);vsom.^(-2).*(u.^2+(v+(-1).*cosi.*r.*WE).^2).^(-3/2).*(( ...
                          -1).*cosi.*u.^2.*vsom.*WE+(-1).*vsomr.*(v+(-1).*cosi.*r.*WE).*( ...
                          u.^2+(v+(-1).*cosi.*r.*WE).^2)),u.*vsom.^(-1).*((-1).*v+cosi.*r.* ...
                          WE).*(u.^2+(v+(-1).*cosi.*r.*WE).^2).^(-3/2),u.^2.*vsom.^(-1).*( ...
                          u.^2+(v+(-1).*cosi.*r.*WE).^2).^(-3/2)];
                      

%%  Cx
Cx=CD0(Mach,ie);
[gradCx,HessCx]=parcCx(Mach,gradMach,HessMach,ie);

%% CNx
CNx=CNa(Mach,ie);
[gradCNx,HessCNx]=parcCNx(Mach,gradMach,HessMach,ie);

FA=q*S*Cx;
FN=q*S*CNx*alfa;
end